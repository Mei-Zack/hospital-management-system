import{i as b}from"./index-18acf776.js";import{m as j,n as G,o as K,p as Q,q as Z,s as I,t as ee,v as te,w as ae}from"./medicine-c36ad563.js";import{d as oe,r as m,a as se,B as le,L as re,b as w,o as z,c as O,e as o,w as s,f as r,g as S,k as ne,t as x,_ as ie}from"./index-459586b0.js";import"./request-51dbdc85.js";const de={class:"statistics-container"},ue={class:"card-header"},ce={key:0,class:"custom-date-range"},ve={class:"overview-item"},fe={class:"overview-value"},pe={class:"overview-item"},_e={class:"overview-value"},me={class:"overview-item"},ge={class:"overview-value"},ye={class:"overview-item"},we={class:"overview-value"},he=oe({__name:"StatisticsView",setup(be){const h=m("month"),g=m(null),_=se({saleAmount:0,saleCount:0,inboundAmount:0,inboundCount:0}),C=m(null),E=m(null),D=m(null),A=m(null),R=m(null);let u=null,c=null,v=null,f=null,p=null;le(()=>{F(),Y(),k(),window.addEventListener("resize",N)}),re(()=>{window.removeEventListener("resize",N),B()});const N=()=>{u==null||u.resize(),c==null||c.resize(),v==null||v.resize(),f==null||f.resize(),p==null||p.resize()},T=t=>{const e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),d=String(t.getDate()).padStart(2,"0");return`${e}-${a}-${d}`},V=t=>t.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,"),Y=()=>{C.value&&(u=b(C.value)),E.value&&(c=b(E.value)),D.value&&(v=b(D.value)),A.value&&(f=b(A.value)),R.value&&(p=b(R.value))},B=()=>{u==null||u.dispose(),c==null||c.dispose(),v==null||v.dispose(),f==null||f.dispose(),p==null||p.dispose(),u=null,c=null,v=null,f=null,p=null},W=()=>{h.value!=="custom"&&(F(),k())},P=()=>{g.value&&k()},F=()=>{const t=new Date;let e,a=t;switch(h.value){case"today":e=new Date(t.getFullYear(),t.getMonth(),t.getDate());break;case"week":const d=t.getDay()||7;e=new Date(t.getFullYear(),t.getMonth(),t.getDate()-d+1);break;case"month":e=new Date(t.getFullYear(),t.getMonth(),1);break;case"year":e=new Date(t.getFullYear(),0,1);break;default:e=new Date(t.getFullYear(),t.getMonth(),1)}g.value=[T(e),T(a)]},k=async()=>{if(!g.value)return;const[t,e]=g.value;try{await $(t,e),await H(t,e),await U(t,e),await q(t,e),await J(),await X(t,e)}catch(a){console.error("加载统计数据失败",a)}},$=async(t,e)=>{try{const[a,d,i,l]=await Promise.all([j(t,e),G(t,e),K(t,e),Q(t,e)]);_.saleAmount=a.data,_.saleCount=d.data,_.inboundAmount=i.data,_.inboundCount=l.data}catch(a){console.error("加载概览数据失败",a)}},H=async(t,e)=>{try{const d=(await Z(t,e)).data,i=[],l=[];d.forEach(n=>{i.push(n.sale_date),l.push(n.total_amount)}),u&&u.setOption({title:{text:"销售趋势",left:"center"},tooltip:{trigger:"axis",formatter:"{b}<br />销售金额: ¥{c}"},xAxis:{type:"category",data:i,axisLabel:{rotate:45}},yAxis:{type:"value",name:"销售金额（元）"},series:[{name:"销售金额",type:"line",data:l,smooth:!0,lineStyle:{width:3,color:"#409EFF"},itemStyle:{color:"#409EFF"}}]})}catch(a){console.error("加载销售趋势数据失败",a)}},U=async(t,e)=>{try{const d=(await I(t,e)).data,i=[],l=[];d.forEach(n=>{i.push(n.inbound_date),l.push(n.total_amount)}),c&&c.setOption({title:{text:"入库趋势",left:"center"},tooltip:{trigger:"axis",formatter:"{b}<br />入库金额: ¥{c}"},xAxis:{type:"category",data:i,axisLabel:{rotate:45}},yAxis:{type:"value",name:"入库金额（元）"},series:[{name:"入库金额",type:"line",data:l,smooth:!0,lineStyle:{width:3,color:"#67C23A"},itemStyle:{color:"#67C23A"}}]})}catch(a){console.error("加载入库趋势数据失败",a)}},q=async(t,e)=>{try{const d=(await ee(t,e)).data,i=[],l=[];d.forEach(n=>{i.push(M(n.category)),l.push(n.total_amount)}),v&&v.setOption({title:{text:"销售分类占比",left:"center"},tooltip:{trigger:"item",formatter:"{b}: ¥{c} ({d}%)"},legend:{orient:"vertical",right:10,top:"center",data:i},series:[{name:"销售金额",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"16",fontWeight:"bold"}},labelLine:{show:!1},data:i.map((n,y)=>({value:l[y],name:n}))}]})}catch(a){console.error("加载销售分类占比数据失败",a)}},J=async()=>{try{const e=(await te()).data,a=[],d=[];e.forEach(i=>{a.push(M(i.category)),d.push(i.count)}),f&&f.setOption({title:{text:"库存分类占比",left:"center"},tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{orient:"vertical",right:10,top:"center",data:a},series:[{name:"库存数量",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"16",fontWeight:"bold"}},labelLine:{show:!1},data:a.map((i,l)=>({value:d[l],name:i}))}]})}catch(t){console.error("加载库存分类占比数据失败",t)}},X=async(t,e)=>{try{const d=(await ae(t,e)).data,i=[],l=[];d.forEach(n=>{i.push(n.medicine_name),l.push(n.total_quantity)}),p&&p.setOption({title:{text:"热销药品排行",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:"{b}: {c}件"},xAxis:{type:"category",data:i,axisLabel:{interval:0,rotate:45}},yAxis:{type:"value",name:"销售数量（件）"},series:[{name:"销售数量",type:"bar",data:l,itemStyle:{color:"#F56C6C"}}]})}catch(a){console.error("加载热销药品排行数据失败",a)}},M=t=>({WESTERN_EXTERNAL:"西药外服",WESTERN_INTERNAL:"西药内用",WESTERN_INJECTION:"西药注射",CHINESE_PATENT:"中成药",CHINESE_HERBAL:"中药饮片",PILL_POWDER:"丸散膏等"})[t]||t;return(t,e)=>{const a=w("el-radio-button"),d=w("el-radio-group"),i=w("el-date-picker"),l=w("el-card"),n=w("el-col"),y=w("el-row");return z(),O("div",de,[o(l,{class:"statistics-card"},{header:s(()=>[r("div",ue,[e[7]||(e[7]=r("h3",null,"药品统计分析",-1)),o(d,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=L=>h.value=L),onChange:W},{default:s(()=>[o(a,{label:"today"},{default:s(()=>e[2]||(e[2]=[S("今日")])),_:1,__:[2]}),o(a,{label:"week"},{default:s(()=>e[3]||(e[3]=[S("本周")])),_:1,__:[3]}),o(a,{label:"month"},{default:s(()=>e[4]||(e[4]=[S("本月")])),_:1,__:[4]}),o(a,{label:"year"},{default:s(()=>e[5]||(e[5]=[S("本年")])),_:1,__:[5]}),o(a,{label:"custom"},{default:s(()=>e[6]||(e[6]=[S("自定义")])),_:1,__:[6]})]),_:1},8,["modelValue"])])]),default:s(()=>[h.value==="custom"?(z(),O("div",ce,[o(i,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=L=>g.value=L),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",onChange:P},null,8,["modelValue"])])):ne("",!0),o(y,{gutter:20,class:"overview-row"},{default:s(()=>[o(n,{span:6},{default:s(()=>[o(l,{class:"overview-card"},{default:s(()=>[r("div",ve,[e[8]||(e[8]=r("div",{class:"overview-title"},"销售总额",-1)),r("div",fe,"¥"+x(V(_.saleAmount)),1)])]),_:1})]),_:1}),o(n,{span:6},{default:s(()=>[o(l,{class:"overview-card"},{default:s(()=>[r("div",pe,[e[9]||(e[9]=r("div",{class:"overview-title"},"销售笔数",-1)),r("div",_e,x(_.saleCount),1)])]),_:1})]),_:1}),o(n,{span:6},{default:s(()=>[o(l,{class:"overview-card"},{default:s(()=>[r("div",me,[e[10]||(e[10]=r("div",{class:"overview-title"},"入库总额",-1)),r("div",ge,"¥"+x(V(_.inboundAmount)),1)])]),_:1})]),_:1}),o(n,{span:6},{default:s(()=>[o(l,{class:"overview-card"},{default:s(()=>[r("div",ye,[e[11]||(e[11]=r("div",{class:"overview-title"},"入库笔数",-1)),r("div",we,x(_.inboundCount),1)])]),_:1})]),_:1})]),_:1}),o(y,{gutter:20,class:"chart-row"},{default:s(()=>[o(n,{span:12},{default:s(()=>[o(l,{class:"chart-card"},{default:s(()=>[e[12]||(e[12]=r("div",{class:"chart-title"},"销售趋势",-1)),r("div",{ref_key:"saleTrendChart",ref:C,class:"chart-container"},null,512)]),_:1,__:[12]})]),_:1}),o(n,{span:12},{default:s(()=>[o(l,{class:"chart-card"},{default:s(()=>[e[13]||(e[13]=r("div",{class:"chart-title"},"入库趋势",-1)),r("div",{ref_key:"inboundTrendChart",ref:E,class:"chart-container"},null,512)]),_:1,__:[13]})]),_:1})]),_:1}),o(y,{gutter:20,class:"chart-row"},{default:s(()=>[o(n,{span:12},{default:s(()=>[o(l,{class:"chart-card"},{default:s(()=>[e[14]||(e[14]=r("div",{class:"chart-title"},"销售分类占比",-1)),r("div",{ref_key:"saleCategoryChart",ref:D,class:"chart-container"},null,512)]),_:1,__:[14]})]),_:1}),o(n,{span:12},{default:s(()=>[o(l,{class:"chart-card"},{default:s(()=>[e[15]||(e[15]=r("div",{class:"chart-title"},"库存分类占比",-1)),r("div",{ref_key:"stockCategoryChart",ref:A,class:"chart-container"},null,512)]),_:1,__:[15]})]),_:1})]),_:1}),o(y,{gutter:20,class:"chart-row"},{default:s(()=>[o(n,{span:24},{default:s(()=>[o(l,{class:"chart-card"},{default:s(()=>[e[16]||(e[16]=r("div",{class:"chart-title"},"热销药品排行",-1)),r("div",{ref_key:"topSellingChart",ref:R,class:"chart-container"},null,512)]),_:1,__:[16]})]),_:1})]),_:1})]),_:1})])}}});const De=ie(he,[["__scopeId","data-v-7f2070df"]]);export{De as default};

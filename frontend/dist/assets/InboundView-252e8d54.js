import{g as fe,e as be,f as _e,h as ge,i as ve}from"./medicine-c36ad563.js";import{d as ye,u as Ve,a as z,r as _,K as De,B as we,b as d,G as he,o as y,c as A,e,w as a,f as G,g as u,F as J,D as K,I as Ie,i as x,t as s,k as ke,E as H,J as Ce,_ as Ne}from"./index-459586b0.js";import"./request-51dbdc85.js";const xe={class:"inbound-container"},Me={class:"card-header"},Ue=ye({__name:"InboundView",setup(qe){var O,L;const V=Ve(),r=z({current:1,size:10,medicineId:void 0,batchNumber:"",startDate:void 0,endDate:void 0}),g=_(null);De(()=>(g.value?(r.startDate=g.value[0],r.endDate=g.value[1]):(r.startDate=void 0,r.endDate=void 0),g.value));const M=_(!1),U=_([]),q=_(0),D=_([]),h=_(!1),S=_(""),Y=_(!1),I=_(),o=z({medicineId:void 0,batchNumber:"",quantity:1,unit:"",purchasePrice:0,totalAmount:0,supplier:"",productionDate:"",expirationDate:"",inboundDate:new Date().toISOString().split("T")[0],operatorId:(O=V.user)==null?void 0:O.id,operatorName:(L=V.user)==null?void 0:L.realName,status:1,remark:""}),W={medicineId:[{required:!0,message:"请选择药品",trigger:"change"}],quantity:[{required:!0,message:"请输入数量",trigger:"blur"}],unit:[{required:!0,message:"请输入单位",trigger:"blur"}],purchasePrice:[{required:!0,message:"请输入进价",trigger:"blur"}],supplier:[{required:!0,message:"请输入供应商",trigger:"blur"}],inboundDate:[{required:!0,message:"请选择入库日期",trigger:"change"}]},C=_(!1),i=z({});we(()=>{X(),v()});const X=async()=>{try{const n=await fe({current:1,size:1e3});n.data&&Array.isArray(n.data.records)?D.value=n.data.records:(D.value=[],console.error("获取药品列表返回的数据格式不正确",n.data))}catch(n){console.error("获取药品列表失败",n)}},v=async()=>{M.value=!0;try{const n=await be({...r,startDate:r.startDate,endDate:r.endDate});n.data&&Array.isArray(n.data.records)?(U.value=n.data.records,q.value=n.data.total||0):(U.value=[],q.value=0,console.error("获取入库记录返回的数据格式不正确",n.data))}catch(n){console.error("获取入库记录失败",n)}finally{M.value=!1}},Z=()=>{r.current=1,v()},ee=()=>{r.current=1,r.medicineId=void 0,r.batchNumber="",g.value=null,r.startDate=void 0,r.endDate=void 0,v()},te=n=>{r.size=n,v()},ae=n=>{r.current=n,v()},B=n=>{const t=D.value.find(f=>f.id===n);return t?t.name:""},le=n=>{const t=D.value.find(f=>f.id===n);t&&(o.unit=t.unit||"",o.purchasePrice=t.purchasePrice,P())},P=()=>{o.quantity&&o.purchasePrice&&(o.totalAmount=o.quantity*o.purchasePrice)},oe=()=>{var n,t;S.value="新增入库",h.value=!0,T(),o.inboundDate=new Date().toISOString().split("T")[0],o.operatorId=(n=V.user)==null?void 0:n.id,o.operatorName=(t=V.user)==null?void 0:t.realName},ne=n=>{_e(n.id).then(t=>{Object.assign(i,t.data),C.value=!0})},T=()=>{var n,t;I.value&&I.value.resetFields(),Object.assign(o,{medicineId:void 0,batchNumber:"",quantity:1,unit:"",purchasePrice:0,totalAmount:0,supplier:"",productionDate:"",expirationDate:"",inboundDate:new Date().toISOString().split("T")[0],operatorId:(n=V.user)==null?void 0:n.id,operatorName:(t=V.user)==null?void 0:t.realName,status:1,remark:""})},re=async()=>{I.value&&await I.value.validate(async n=>{if(n){Y.value=!0;try{await ge(o),H.success("入库成功"),h.value=!1,v()}catch(t){console.error("入库失败",t)}finally{Y.value=!1}}})},ue=n=>{Ce.confirm("确定要撤销该入库记录吗？撤销后将减少对应药品的库存","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ve(n.id),H.success("撤销成功"),v()}catch(t){console.error("撤销失败",t)}}).catch(()=>{})};return(n,t)=>{const f=d("el-button"),F=d("el-option"),E=d("el-select"),p=d("el-form-item"),w=d("el-input"),N=d("el-date-picker"),$=d("el-form"),m=d("el-table-column"),j=d("el-tag"),de=d("el-table"),ie=d("el-pagination"),se=d("el-card"),b=d("el-col"),k=d("el-row"),R=d("el-input-number"),Q=d("el-dialog"),c=d("el-descriptions-item"),pe=d("el-descriptions"),me=he("loading");return y(),A("div",xe,[e(se,{class:"inbound-card"},{header:a(()=>[G("div",Me,[t[21]||(t[21]=G("h3",null,"药品入库管理",-1)),e(f,{type:"primary",onClick:oe},{default:a(()=>t[20]||(t[20]=[u("新增入库")])),_:1,__:[20]})])]),default:a(()=>[e($,{inline:!0,model:r,class:"search-form"},{default:a(()=>[e(p,{label:"药品名称"},{default:a(()=>[e(E,{modelValue:r.medicineId,"onUpdate:modelValue":t[0]||(t[0]=l=>r.medicineId=l),placeholder:"请选择药品",clearable:"",filterable:""},{default:a(()=>[(y(!0),A(J,null,K(D.value,l=>(y(),x(F,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"批次号"},{default:a(()=>[e(w,{modelValue:r.batchNumber,"onUpdate:modelValue":t[1]||(t[1]=l=>r.batchNumber=l),placeholder:"请输入批次号",clearable:""},null,8,["modelValue"])]),_:1}),e(p,{label:"入库日期"},{default:a(()=>[e(N,{modelValue:g.value,"onUpdate:modelValue":t[2]||(t[2]=l=>g.value=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(p,null,{default:a(()=>[e(f,{type:"primary",onClick:Z},{default:a(()=>t[22]||(t[22]=[u("查询")])),_:1,__:[22]}),e(f,{onClick:ee},{default:a(()=>t[23]||(t[23]=[u("重置")])),_:1,__:[23]})]),_:1})]),_:1},8,["model"]),Ie((y(),x(de,{data:U.value,style:{width:"100%"}},{default:a(()=>[e(m,{prop:"id",label:"入库ID",width:"80"}),e(m,{label:"药品名称",width:"150"},{default:a(l=>[u(s(B(l.row.medicineId)),1)]),_:1}),e(m,{prop:"batchNumber",label:"批次号",width:"120"}),e(m,{prop:"quantity",label:"数量",width:"80"}),e(m,{prop:"unit",label:"单位",width:"80"}),e(m,{prop:"purchasePrice",label:"进价",width:"100"}),e(m,{prop:"totalAmount",label:"总金额",width:"100"}),e(m,{prop:"supplier",label:"供应商",width:"150"}),e(m,{prop:"productionDate",label:"生产日期",width:"120"}),e(m,{prop:"expirationDate",label:"有效期至",width:"120"}),e(m,{prop:"inboundDate",label:"入库日期",width:"120"}),e(m,{prop:"operatorName",label:"操作人",width:"100"}),e(m,{prop:"status",label:"状态",width:"100"},{default:a(l=>[e(j,{type:l.row.status===1?"success":"danger"},{default:a(()=>[u(s(l.row.status===1?"正常":"已撤销"),1)]),_:2},1032,["type"])]),_:1}),e(m,{label:"操作",width:"120",fixed:"right"},{default:a(l=>[l.row.status===1?(y(),x(f,{key:0,type:"danger",link:"",onClick:ce=>ue(l.row)},{default:a(()=>t[24]||(t[24]=[u("撤销")])),_:2,__:[24]},1032,["onClick"])):ke("",!0),e(f,{type:"primary",link:"",onClick:ce=>ne(l.row)},{default:a(()=>t[25]||(t[25]=[u("详情")])),_:2,__:[25]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[me,M.value]]),e(ie,{"current-page":r.current,"onUpdate:currentPage":t[3]||(t[3]=l=>r.current=l),"page-size":r.size,"onUpdate:pageSize":t[4]||(t[4]=l=>r.size=l),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:q.value,onSizeChange:te,onCurrentChange:ae},null,8,["current-page","page-size","total"])]),_:1}),e(Q,{modelValue:h.value,"onUpdate:modelValue":t[17]||(t[17]=l=>h.value=l),title:S.value,width:"800px",onClosed:T},{footer:a(()=>[e(f,{onClick:t[16]||(t[16]=l=>h.value=!1)},{default:a(()=>t[26]||(t[26]=[u("取消")])),_:1,__:[26]}),e(f,{type:"primary",onClick:re,loading:Y.value},{default:a(()=>t[27]||(t[27]=[u("确定")])),_:1,__:[27]},8,["loading"])]),default:a(()=>[e($,{ref_key:"formRef",ref:I,model:o,rules:W,"label-width":"100px"},{default:a(()=>[e(k,{gutter:20},{default:a(()=>[e(b,{span:12},{default:a(()=>[e(p,{label:"药品",prop:"medicineId"},{default:a(()=>[e(E,{modelValue:o.medicineId,"onUpdate:modelValue":t[5]||(t[5]=l=>o.medicineId=l),placeholder:"请选择药品",filterable:"",onChange:le},{default:a(()=>[(y(!0),A(J,null,K(D.value,l=>(y(),x(F,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:a(()=>[e(p,{label:"批次号",prop:"batchNumber"},{default:a(()=>[e(w,{modelValue:o.batchNumber,"onUpdate:modelValue":t[6]||(t[6]=l=>o.batchNumber=l),placeholder:"请输入批次号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(k,{gutter:20},{default:a(()=>[e(b,{span:12},{default:a(()=>[e(p,{label:"数量",prop:"quantity"},{default:a(()=>[e(R,{modelValue:o.quantity,"onUpdate:modelValue":t[7]||(t[7]=l=>o.quantity=l),min:1,precision:0,onChange:P},null,8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:a(()=>[e(p,{label:"单位",prop:"unit"},{default:a(()=>[e(w,{modelValue:o.unit,"onUpdate:modelValue":t[8]||(t[8]=l=>o.unit=l),placeholder:"请输入单位"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(k,{gutter:20},{default:a(()=>[e(b,{span:12},{default:a(()=>[e(p,{label:"进价",prop:"purchasePrice"},{default:a(()=>[e(R,{modelValue:o.purchasePrice,"onUpdate:modelValue":t[9]||(t[9]=l=>o.purchasePrice=l),min:0,precision:2,step:.01,onChange:P},null,8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:a(()=>[e(p,{label:"总金额"},{default:a(()=>[e(w,{modelValue:o.totalAmount,"onUpdate:modelValue":t[10]||(t[10]=l=>o.totalAmount=l),disabled:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(k,{gutter:20},{default:a(()=>[e(b,{span:12},{default:a(()=>[e(p,{label:"供应商",prop:"supplier"},{default:a(()=>[e(w,{modelValue:o.supplier,"onUpdate:modelValue":t[11]||(t[11]=l=>o.supplier=l),placeholder:"请输入供应商"},null,8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:a(()=>[e(p,{label:"入库日期",prop:"inboundDate"},{default:a(()=>[e(N,{modelValue:o.inboundDate,"onUpdate:modelValue":t[12]||(t[12]=l=>o.inboundDate=l),type:"date",placeholder:"选择日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(k,{gutter:20},{default:a(()=>[e(b,{span:12},{default:a(()=>[e(p,{label:"生产日期",prop:"productionDate"},{default:a(()=>[e(N,{modelValue:o.productionDate,"onUpdate:modelValue":t[13]||(t[13]=l=>o.productionDate=l),type:"date",placeholder:"选择日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:a(()=>[e(p,{label:"有效期至",prop:"expirationDate"},{default:a(()=>[e(N,{modelValue:o.expirationDate,"onUpdate:modelValue":t[14]||(t[14]=l=>o.expirationDate=l),type:"date",placeholder:"选择日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(p,{label:"备注",prop:"remark"},{default:a(()=>[e(w,{modelValue:o.remark,"onUpdate:modelValue":t[15]||(t[15]=l=>o.remark=l),type:"textarea",rows:2,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(Q,{modelValue:C.value,"onUpdate:modelValue":t[19]||(t[19]=l=>C.value=l),title:"入库详情",width:"800px"},{footer:a(()=>[e(f,{onClick:t[18]||(t[18]=l=>C.value=!1)},{default:a(()=>t[28]||(t[28]=[u("关闭")])),_:1,__:[28]})]),default:a(()=>[e(pe,{column:2,border:""},{default:a(()=>[e(c,{label:"入库ID"},{default:a(()=>[u(s(i.id),1)]),_:1}),e(c,{label:"药品名称"},{default:a(()=>[u(s(B(i.medicineId||0)),1)]),_:1}),e(c,{label:"批次号"},{default:a(()=>[u(s(i.batchNumber),1)]),_:1}),e(c,{label:"数量"},{default:a(()=>[u(s(i.quantity)+" "+s(i.unit),1)]),_:1}),e(c,{label:"进价"},{default:a(()=>[u(s(i.purchasePrice),1)]),_:1}),e(c,{label:"总金额"},{default:a(()=>[u(s(i.totalAmount),1)]),_:1}),e(c,{label:"供应商"},{default:a(()=>[u(s(i.supplier),1)]),_:1}),e(c,{label:"入库日期"},{default:a(()=>[u(s(i.inboundDate),1)]),_:1}),e(c,{label:"生产日期"},{default:a(()=>[u(s(i.productionDate),1)]),_:1}),e(c,{label:"有效期至"},{default:a(()=>[u(s(i.expirationDate),1)]),_:1}),e(c,{label:"操作人"},{default:a(()=>[u(s(i.operatorName),1)]),_:1}),e(c,{label:"状态"},{default:a(()=>[e(j,{type:i.status===1?"success":"danger"},{default:a(()=>[u(s(i.status===1?"正常":"已撤销"),1)]),_:1},8,["type"])]),_:1}),e(c,{label:"备注",span:2},{default:a(()=>[u(s(i.remark),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});const Ae=Ne(Ue,[["__scopeId","data-v-fa2ba802"]]);export{Ae as default};

import{g as pe,a as me,d as fe,u as ce,b as ge,c as be}from"./medicine-c36ad563.js";import{d as _e,a as I,r as g,B as ve,b as d,G as Ve,o as V,c as w,e,w as t,f as C,g as f,F as N,D as P,I as ye,i as ke,t as D,J as we,E as F,_ as Ce}from"./index-459586b0.js";import"./request-51dbdc85.js";const Ue={class:"medicine-container"},xe={class:"card-header"},Ee=_e({__name:"MedicineView",setup(Ne){const r=I({current:1,size:10,name:"",category:"",status:void 0}),S=[{value:"WESTERN_EXTERNAL",label:"西药外服"},{value:"WESTERN_INTERNAL",label:"西药内用"},{value:"WESTERN_INJECTION",label:"西药注射"},{value:"CHINESE_PATENT",label:"中成药"},{value:"CHINESE_HERBAL",label:"中药饮片"},{value:"PILL_POWDER",label:"丸散膏等"}],q=[{value:1,label:"正常"},{value:0,label:"禁用"},{value:2,label:"缺货"},{value:3,label:"即将过期"},{value:4,label:"已过期"}],L=g(!1),$=g([]),O=g(0),v=g(!1),T=g(""),y=g(),M=g(!1),o=I({name:"",code:"",category:"",dosageForm:"",specification:"",usage:"",stock:0,unit:"",manufacturer:"",purchasePrice:0,salePrice:0,batchNumber:"",productionDate:"",expirationDate:"",contraindication:"",status:1,remark:""}),J={name:[{required:!0,message:"请输入药品名称",trigger:"blur"}],category:[{required:!0,message:"请选择药品分类",trigger:"change"}],dosageForm:[{required:!0,message:"请输入剂型",trigger:"blur"}],specification:[{required:!0,message:"请输入规格",trigger:"blur"}],unit:[{required:!0,message:"请输入单位",trigger:"blur"}],manufacturer:[{required:!0,message:"请输入厂家",trigger:"blur"}],purchasePrice:[{required:!0,message:"请输入进价",trigger:"blur"}],salePrice:[{required:!0,message:"请输入售价",trigger:"blur"}]},k=g(!1),Q=g(),z=g(!1),m=I({id:0,name:"",currentStock:0,quantity:0});ve(()=>{b()});const b=()=>{L.value=!0,pe(r).then(u=>{$.value=u.data.records,O.value=u.data.total}).finally(()=>{L.value=!1})},A=()=>{r.current=1,b()},G=()=>{r.name="",r.category="",r.status=void 0,A()},X=()=>{R(),T.value="新增药品",v.value=!0},K=u=>{R(),T.value="编辑药品",me(u.id).then(l=>{Object.assign(o,l.data),v.value=!0})},Y=u=>{we.confirm(`确认删除药品 ${u.name} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{fe(u.id).then(()=>{F.success("删除成功"),b()})})},Z=u=>{m.id=u.id,m.name=u.name,m.currentStock=u.stock,m.quantity=0,k.value=!0},h=()=>{if(m.quantity===0){F.warning("请输入变更数量");return}z.value=!0,ce(m.id,m.quantity).then(()=>{F.success("库存更新成功"),k.value=!1,b()}).finally(()=>{z.value=!1})},ee=async()=>{y.value&&await y.value.validate(u=>{u&&(M.value=!0,(o.id?ge:be)(o).then(()=>{F.success(`${o.id?"更新":"新增"}成功`),v.value=!1,b()}).finally(()=>{M.value=!1}))})},R=()=>{y.value&&y.value.resetFields(),Object.assign(o,{id:void 0,name:"",code:"",category:"",dosageForm:"",specification:"",usage:"",stock:0,unit:"",manufacturer:"",purchasePrice:0,salePrice:0,batchNumber:"",productionDate:"",expirationDate:"",contraindication:"",status:1,remark:""})},le=u=>{r.size=u,b()},ae=u=>{r.current=u,b()},te=u=>{const l=S.find(i=>i.value===u);return l?l.label:u},oe=u=>{const l=q.find(i=>i.value===u);return l?l.label:"未知"},ue=u=>{switch(u){case 1:return"success";case 0:return"info";case 2:return"warning";case 3:return"warning";case 4:return"danger";default:return"info"}};return(u,l)=>{const i=d("el-button"),c=d("el-input"),n=d("el-form-item"),U=d("el-option"),x=d("el-select"),B=d("el-form"),p=d("el-table-column"),ne=d("el-tag"),re=d("el-table"),de=d("el-pagination"),ie=d("el-card"),s=d("el-col"),_=d("el-row"),E=d("el-input-number"),W=d("el-date-picker"),j=d("el-dialog"),se=Ve("loading");return V(),w("div",Ue,[e(ie,{class:"medicine-card"},{header:t(()=>[C("div",xe,[l[28]||(l[28]=C("h3",null,"药品管理",-1)),e(i,{type:"primary",onClick:X},{default:t(()=>l[27]||(l[27]=[f("新增药品")])),_:1,__:[27]})])]),default:t(()=>[e(B,{inline:!0,model:r,class:"search-form"},{default:t(()=>[e(n,{label:"药品名称"},{default:t(()=>[e(c,{modelValue:r.name,"onUpdate:modelValue":l[0]||(l[0]=a=>r.name=a),placeholder:"请输入药品名称",clearable:""},null,8,["modelValue"])]),_:1}),e(n,{label:"药品分类"},{default:t(()=>[e(x,{modelValue:r.category,"onUpdate:modelValue":l[1]||(l[1]=a=>r.category=a),placeholder:"请选择分类",clearable:""},{default:t(()=>[(V(),w(N,null,P(S,a=>e(U,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(n,{label:"状态"},{default:t(()=>[e(x,{modelValue:r.status,"onUpdate:modelValue":l[2]||(l[2]=a=>r.status=a),placeholder:"请选择状态",clearable:""},{default:t(()=>[(V(),w(N,null,P(q,a=>e(U,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(n,null,{default:t(()=>[e(i,{type:"primary",onClick:A},{default:t(()=>l[29]||(l[29]=[f("查询")])),_:1,__:[29]}),e(i,{onClick:G},{default:t(()=>l[30]||(l[30]=[f("重置")])),_:1,__:[30]})]),_:1})]),_:1},8,["model"]),ye((V(),ke(re,{data:$.value,style:{width:"100%"}},{default:t(()=>[e(p,{prop:"code",label:"药品编码",width:"120"}),e(p,{prop:"name",label:"药品名称",width:"150"}),e(p,{prop:"category",label:"分类",width:"120"},{default:t(a=>[f(D(te(a.row.category)),1)]),_:1}),e(p,{prop:"dosageForm",label:"剂型",width:"100"}),e(p,{prop:"specification",label:"规格",width:"120"}),e(p,{prop:"stock",label:"库存",width:"80"}),e(p,{prop:"unit",label:"单位",width:"80"}),e(p,{prop:"manufacturer",label:"厂家",width:"150"}),e(p,{prop:"purchasePrice",label:"进价",width:"100"}),e(p,{prop:"salePrice",label:"售价",width:"100"}),e(p,{prop:"expirationDate",label:"有效期至",width:"120"}),e(p,{prop:"status",label:"状态",width:"100"},{default:t(a=>[e(ne,{type:ue(a.row.status)},{default:t(()=>[f(D(oe(a.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(p,{label:"操作",width:"200",fixed:"right"},{default:t(a=>[e(i,{type:"primary",link:"",onClick:H=>K(a.row)},{default:t(()=>l[31]||(l[31]=[f("编辑")])),_:2,__:[31]},1032,["onClick"]),e(i,{type:"primary",link:"",onClick:H=>Z(a.row)},{default:t(()=>l[32]||(l[32]=[f("库存")])),_:2,__:[32]},1032,["onClick"]),e(i,{type:"danger",link:"",onClick:H=>Y(a.row)},{default:t(()=>l[33]||(l[33]=[f("删除")])),_:2,__:[33]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[se,L.value]]),e(de,{"current-page":r.current,"onUpdate:currentPage":l[3]||(l[3]=a=>r.current=a),"page-size":r.size,"onUpdate:pageSize":l[4]||(l[4]=a=>r.size=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:O.value,onSizeChange:le,onCurrentChange:ae},null,8,["current-page","page-size","total"])]),_:1}),e(j,{modelValue:v.value,"onUpdate:modelValue":l[23]||(l[23]=a=>v.value=a),title:T.value,width:"800px",onClosed:R},{footer:t(()=>[e(i,{onClick:l[22]||(l[22]=a=>v.value=!1)},{default:t(()=>l[34]||(l[34]=[f("取消")])),_:1,__:[34]}),e(i,{type:"primary",onClick:ee,loading:M.value},{default:t(()=>l[35]||(l[35]=[f("确定")])),_:1,__:[35]},8,["loading"])]),default:t(()=>[e(B,{ref_key:"formRef",ref:y,model:o,rules:J,"label-width":"100px"},{default:t(()=>[e(_,{gutter:20},{default:t(()=>[e(s,{span:12},{default:t(()=>[e(n,{label:"药品名称",prop:"name"},{default:t(()=>[e(c,{modelValue:o.name,"onUpdate:modelValue":l[5]||(l[5]=a=>o.name=a),placeholder:"请输入药品名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:t(()=>[e(n,{label:"药品编码",prop:"code"},{default:t(()=>[e(c,{modelValue:o.code,"onUpdate:modelValue":l[6]||(l[6]=a=>o.code=a),placeholder:"请输入药品编码"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(_,{gutter:20},{default:t(()=>[e(s,{span:12},{default:t(()=>[e(n,{label:"药品分类",prop:"category"},{default:t(()=>[e(x,{modelValue:o.category,"onUpdate:modelValue":l[7]||(l[7]=a=>o.category=a),placeholder:"请选择分类"},{default:t(()=>[(V(),w(N,null,P(S,a=>e(U,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:t(()=>[e(n,{label:"剂型",prop:"dosageForm"},{default:t(()=>[e(c,{modelValue:o.dosageForm,"onUpdate:modelValue":l[8]||(l[8]=a=>o.dosageForm=a),placeholder:"请输入剂型"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(_,{gutter:20},{default:t(()=>[e(s,{span:12},{default:t(()=>[e(n,{label:"规格",prop:"specification"},{default:t(()=>[e(c,{modelValue:o.specification,"onUpdate:modelValue":l[9]||(l[9]=a=>o.specification=a),placeholder:"请输入规格"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:t(()=>[e(n,{label:"单位",prop:"unit"},{default:t(()=>[e(c,{modelValue:o.unit,"onUpdate:modelValue":l[10]||(l[10]=a=>o.unit=a),placeholder:"请输入单位"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(_,{gutter:20},{default:t(()=>[e(s,{span:12},{default:t(()=>[e(n,{label:"库存",prop:"stock"},{default:t(()=>[e(E,{modelValue:o.stock,"onUpdate:modelValue":l[11]||(l[11]=a=>o.stock=a),min:0,precision:0},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:t(()=>[e(n,{label:"厂家",prop:"manufacturer"},{default:t(()=>[e(c,{modelValue:o.manufacturer,"onUpdate:modelValue":l[12]||(l[12]=a=>o.manufacturer=a),placeholder:"请输入厂家"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(_,{gutter:20},{default:t(()=>[e(s,{span:12},{default:t(()=>[e(n,{label:"进价",prop:"purchasePrice"},{default:t(()=>[e(E,{modelValue:o.purchasePrice,"onUpdate:modelValue":l[13]||(l[13]=a=>o.purchasePrice=a),min:0,precision:2,step:.01},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:t(()=>[e(n,{label:"售价",prop:"salePrice"},{default:t(()=>[e(E,{modelValue:o.salePrice,"onUpdate:modelValue":l[14]||(l[14]=a=>o.salePrice=a),min:0,precision:2,step:.01},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(_,{gutter:20},{default:t(()=>[e(s,{span:12},{default:t(()=>[e(n,{label:"批号",prop:"batchNumber"},{default:t(()=>[e(c,{modelValue:o.batchNumber,"onUpdate:modelValue":l[15]||(l[15]=a=>o.batchNumber=a),placeholder:"请输入批号"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:t(()=>[e(n,{label:"生产日期",prop:"productionDate"},{default:t(()=>[e(W,{modelValue:o.productionDate,"onUpdate:modelValue":l[16]||(l[16]=a=>o.productionDate=a),type:"date",placeholder:"选择日期"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(_,{gutter:20},{default:t(()=>[e(s,{span:12},{default:t(()=>[e(n,{label:"有效期至",prop:"expirationDate"},{default:t(()=>[e(W,{modelValue:o.expirationDate,"onUpdate:modelValue":l[17]||(l[17]=a=>o.expirationDate=a),type:"date",placeholder:"选择日期"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:t(()=>[e(n,{label:"状态",prop:"status"},{default:t(()=>[e(x,{modelValue:o.status,"onUpdate:modelValue":l[18]||(l[18]=a=>o.status=a),placeholder:"请选择状态"},{default:t(()=>[(V(),w(N,null,P(q,a=>e(U,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(n,{label:"用法用量",prop:"usage"},{default:t(()=>[e(c,{modelValue:o.usage,"onUpdate:modelValue":l[19]||(l[19]=a=>o.usage=a),type:"textarea",rows:2,placeholder:"请输入用法用量"},null,8,["modelValue"])]),_:1}),e(n,{label:"特殊禁忌",prop:"contraindication"},{default:t(()=>[e(c,{modelValue:o.contraindication,"onUpdate:modelValue":l[20]||(l[20]=a=>o.contraindication=a),type:"textarea",rows:2,placeholder:"请输入特殊禁忌"},null,8,["modelValue"])]),_:1}),e(n,{label:"备注",prop:"remark"},{default:t(()=>[e(c,{modelValue:o.remark,"onUpdate:modelValue":l[21]||(l[21]=a=>o.remark=a),type:"textarea",rows:2,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(j,{modelValue:k.value,"onUpdate:modelValue":l[26]||(l[26]=a=>k.value=a),title:"更新库存",width:"400px"},{footer:t(()=>[e(i,{onClick:l[25]||(l[25]=a=>k.value=!1)},{default:t(()=>l[37]||(l[37]=[f("取消")])),_:1,__:[37]}),e(i,{type:"primary",onClick:h,loading:z.value},{default:t(()=>l[38]||(l[38]=[f("确定")])),_:1,__:[38]},8,["loading"])]),default:t(()=>[e(B,{ref_key:"stockFormRef",ref:Q,model:m,"label-width":"100px"},{default:t(()=>[e(n,{label:"药品名称"},{default:t(()=>[C("span",null,D(m.name),1)]),_:1}),e(n,{label:"当前库存"},{default:t(()=>[C("span",null,D(m.currentStock),1)]),_:1}),e(n,{label:"变更数量",prop:"quantity"},{default:t(()=>[e(E,{modelValue:m.quantity,"onUpdate:modelValue":l[24]||(l[24]=a=>m.quantity=a),precision:0},null,8,["modelValue"]),l[36]||(l[36]=C("div",{class:"tip"},"正数为增加，负数为减少",-1))]),_:1,__:[36]})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});const Se=Ce(Ee,[["__scopeId","data-v-fe56b751"]]);export{Se as default};

import{_ as te,u as le,r as b,a as j,B as ae,E as f,b as s,G as oe,o as u,c as k,e as l,w as a,f as x,F as C,D,g as i,j as q,i as w,k as U,I as re,t as ne,J as se}from"./index-459586b0.js";import{g as ue,c as de,u as ie,a as ce}from"./doctor-b032f4ea.js";import"./request-51dbdc85.js";const pe={class:"doctor-container"},me={class:"card-header"},_e={class:"pagination"},fe={class:"dialog-footer"},ve={__name:"DoctorView",setup(ge){const N=le(),B=b([]),S=b(!1),$=b(0),p=b(!1),d=b(""),V=b(null),E=["内科","外科","妇产科","儿科","眼科","耳鼻喉科","口腔科","皮肤科","神经科","精神科","中医科","麻醉科","影像科","检验科","病理科","营养科","康复科"],O=["主任医师","副主任医师","主治医师","住院医师","医士"],n=j({department:"",title:"",current:1,size:10}),o=j({id:null,department:"",title:"",specialty:"",schedule:""}),I={department:[{required:!0,message:"请选择科室",trigger:"change"}],title:[{required:!0,message:"请选择职称",trigger:"change"}],specialty:[{required:!0,message:"请填写专长",trigger:"blur"}],schedule:[{required:!0,message:"请填写出诊时间",trigger:"blur"}]};ae(()=>{v()});const v=async()=>{S.value=!0;try{const r=await ue({...n});B.value=r.data.records,$.value=r.data.total}catch(r){console.error("获取医生列表失败",r),f.error("获取医生列表失败")}finally{S.value=!1}},A=()=>{n.current=1,v()},R=r=>{n.current=r,v()},G=r=>{n.size=r,n.current=1,v()},L=()=>{h(),d.value="add",p.value=!0},P=r=>{h(),Object.assign(o,r),d.value="edit",p.value=!0},H=r=>{h(),Object.assign(o,r),d.value="view",p.value=!0},h=()=>{o.id=null,o.department="",o.title="",o.specialty="",o.schedule="",V.value&&V.value.resetFields()},K=async()=>{V.value&&await V.value.validate(async r=>{if(r)try{try{o.schedule&&typeof o.schedule=="string"&&JSON.parse(o.schedule)}catch{f.error('出诊时间必须是有效的JSON格式，例如：{"周一": "上午9:00-11:30", "周三": "下午2:00-5:00"}');return}d.value==="add"?(await de(o),f.success("添加成功")):d.value==="edit"&&(await ie(o),f.success("更新成功")),p.value=!1,v()}catch(t){console.error("操作失败",t),f.error("操作失败")}})},F=(r,t)=>{const m=t===1?"复职":"离职";se.confirm(`确定要将该医生设为${m}状态吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ce(r,{status:t}),f.success(`${m}操作成功`),v()}catch(g){console.error("操作失败",g),f.error("操作失败")}}).catch(()=>{})};return(r,t)=>{const m=s("el-option"),g=s("el-select"),_=s("el-form-item"),c=s("el-button"),J=s("el-form"),y=s("el-table-column"),Q=s("el-tag"),W=s("el-table"),X=s("el-pagination"),Y=s("el-card"),M=s("el-input"),Z=s("el-dialog"),ee=oe("loading");return u(),k("div",pe,[l(Y,null,{header:a(()=>[x("div",me,[l(J,{inline:!0,model:n},{default:a(()=>[l(_,null,{default:a(()=>[l(g,{modelValue:n.department,"onUpdate:modelValue":t[0]||(t[0]=e=>n.department=e),placeholder:"科室",clearable:""},{default:a(()=>[(u(),k(C,null,D(E,e=>l(m,{key:e,label:e,value:e},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(_,null,{default:a(()=>[l(g,{modelValue:n.title,"onUpdate:modelValue":t[1]||(t[1]=e=>n.title=e),placeholder:"职称",clearable:""},{default:a(()=>[(u(),k(C,null,D(O,e=>l(m,{key:e,label:e,value:e},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(_,null,{default:a(()=>{var e;return[l(c,{type:"primary",onClick:A},{default:a(()=>t[10]||(t[10]=[i("搜索")])),_:1,__:[10]}),((e=q(N).user)==null?void 0:e.role)==="ADMIN"?(u(),w(c,{key:0,type:"success",onClick:L},{default:a(()=>t[11]||(t[11]=[i(" 添加医生 ")])),_:1,__:[11]})):U("",!0)]}),_:1})]),_:1},8,["model"])])]),default:a(()=>[re((u(),w(W,{data:B.value,border:"",style:{width:"100%"}},{default:a(()=>[l(y,{prop:"department",label:"科室"}),l(y,{prop:"title",label:"职称"}),l(y,{prop:"specialty",label:"专长"}),l(y,{prop:"schedule",label:"出诊时间"}),l(y,{prop:"status",label:"状态"},{default:a(({row:e})=>[l(Q,{type:e.status===1?"success":"danger"},{default:a(()=>[i(ne(e.status===1?"在职":"离职"),1)]),_:2},1032,["type"])]),_:1}),l(y,{label:"操作",width:"250"},{default:a(({row:e})=>{var T;return[l(c,{type:"primary",link:"",onClick:z=>H(e)},{default:a(()=>t[12]||(t[12]=[i(" 查看 ")])),_:2,__:[12]},1032,["onClick"]),((T=q(N).user)==null?void 0:T.role)==="ADMIN"?(u(),k(C,{key:0},[l(c,{type:"success",link:"",onClick:z=>P(e)},{default:a(()=>t[13]||(t[13]=[i(" 编辑 ")])),_:2,__:[13]},1032,["onClick"]),e.status===1?(u(),w(c,{key:0,type:"danger",link:"",onClick:z=>F(e.id,0)},{default:a(()=>t[14]||(t[14]=[i(" 离职 ")])),_:2,__:[14]},1032,["onClick"])):(u(),w(c,{key:1,type:"success",link:"",onClick:z=>F(e.id,1)},{default:a(()=>t[15]||(t[15]=[i(" 复职 ")])),_:2,__:[15]},1032,["onClick"]))],64)):U("",!0)]}),_:1})]),_:1},8,["data"])),[[ee,S.value]]),x("div",_e,[l(X,{"current-page":n.current,"onUpdate:currentPage":t[2]||(t[2]=e=>n.current=e),"page-size":n.size,"onUpdate:pageSize":t[3]||(t[3]=e=>n.size=e),"page-sizes":[10,20,50],total:$.value,layout:"total, sizes, prev, pager, next",onSizeChange:G,onCurrentChange:R},null,8,["current-page","page-size","total"])])]),_:1}),l(Z,{modelValue:p.value,"onUpdate:modelValue":t[9]||(t[9]=e=>p.value=e),title:d.value==="add"?"添加医生":d.value==="edit"?"编辑医生":"医生详情",width:"500px"},{footer:a(()=>[x("span",fe,[l(c,{onClick:t[8]||(t[8]=e=>p.value=!1)},{default:a(()=>t[17]||(t[17]=[i("取消")])),_:1,__:[17]}),d.value!=="view"?(u(),w(c,{key:0,type:"primary",onClick:K},{default:a(()=>t[18]||(t[18]=[i(" 确认 ")])),_:1,__:[18]})):U("",!0)])]),default:a(()=>[l(J,{ref_key:"formRef",ref:V,model:o,rules:I,"label-width":"100px",disabled:d.value==="view"},{default:a(()=>[l(_,{label:"科室",prop:"department"},{default:a(()=>[l(g,{modelValue:o.department,"onUpdate:modelValue":t[4]||(t[4]=e=>o.department=e),placeholder:"请选择科室"},{default:a(()=>[(u(),k(C,null,D(E,e=>l(m,{key:e,label:e,value:e},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(_,{label:"职称",prop:"title"},{default:a(()=>[l(g,{modelValue:o.title,"onUpdate:modelValue":t[5]||(t[5]=e=>o.title=e),placeholder:"请选择职称"},{default:a(()=>[(u(),k(C,null,D(O,e=>l(m,{key:e,label:e,value:e},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(_,{label:"专长",prop:"specialty"},{default:a(()=>[l(M,{modelValue:o.specialty,"onUpdate:modelValue":t[6]||(t[6]=e=>o.specialty=e),type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),l(_,{label:"出诊时间",prop:"schedule"},{default:a(()=>[l(M,{modelValue:o.schedule,"onUpdate:modelValue":t[7]||(t[7]=e=>o.schedule=e),type:"textarea",rows:2,placeholder:'请输入JSON格式，例如：{"周一": "上午9:00-11:30", "周三": "下午2:00-5:00"}'},null,8,["modelValue"]),t[16]||(t[16]=x("div",{class:"form-tip"},'请使用JSON格式输入出诊时间，例如：{"周一": "上午9:00-11:30", "周三": "下午2:00-5:00"}',-1))]),_:1,__:[16]})]),_:1},8,["model","disabled"])]),_:1},8,["modelValue","title"])])}}},Ve=te(ve,[["__scopeId","data-v-443a1e1c"]]);export{Ve as default};

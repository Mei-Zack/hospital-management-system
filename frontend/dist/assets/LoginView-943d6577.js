import{d as V,u as k,r as _,a as h,b as n,o as b,c as x,e as t,w as a,f as C,g as f,h as T,_ as U}from"./index-459586b0.js";import{l as L}from"./auth-07d929a4.js";import"./request-51dbdc85.js";const N={class:"login-container"},S=V({__name:"LoginView",setup(B){const m=T(),l=k(),u=_(),i=_(!1),o=h({username:"",password:""}),g={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},w=async()=>{if(u.value){await u.value.validate();try{i.value=!0,o.username=o.username.trim(),o.password=o.password.trim(),console.log("正在发送登录请求...");try{const s=await(await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:o.username,password:o.password})})).json();if(console.log("原生fetch响应:",s),s.code===200&&s.data){l.setToken(s.data.token),l.setUser(s.data.user),m.push("/");return}}catch(e){console.error("原生fetch请求失败:",e)}const r=await L(o);if(console.log("axios登录响应:",r),r.code===200&&r.data){if(!r.data.token){console.error("返回的响应中没有token");return}l.setToken(r.data.token),l.setUser(r.data.user),console.log("登录成功，正在跳转..."),m.push("/")}else console.error("登录响应格式不正确:",r)}catch(r){console.error("登录失败:",r)}finally{i.value=!1}}};return(r,e)=>{const s=n("el-input"),p=n("el-form-item"),c=n("el-button"),v=n("el-form"),y=n("el-card");return b(),x("div",N,[t(y,{class:"login-card"},{header:a(()=>e[3]||(e[3]=[C("h2",null,"医院管理系统登录",-1)])),default:a(()=>[t(v,{ref_key:"formRef",ref:u,model:o,rules:g,"label-width":"80px"},{default:a(()=>[t(p,{label:"用户名",prop:"username"},{default:a(()=>[t(s,{modelValue:o.username,"onUpdate:modelValue":e[0]||(e[0]=d=>o.username=d),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),t(p,{label:"密码",prop:"password"},{default:a(()=>[t(s,{modelValue:o.password,"onUpdate:modelValue":e[1]||(e[1]=d=>o.password=d),type:"password",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(p,null,{default:a(()=>[t(c,{type:"primary",onClick:w,loading:i.value},{default:a(()=>e[4]||(e[4]=[f("登录")])),_:1,__:[4]},8,["loading"]),t(c,{onClick:e[2]||(e[2]=d=>r.$router.push("/register"))},{default:a(()=>e[5]||(e[5]=[f("注册")])),_:1,__:[5]})]),_:1})]),_:1},8,["model"])]),_:1})])}}});const E=U(S,[["__scopeId","data-v-5c031749"]]);export{E as default};
